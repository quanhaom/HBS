package frame;

import java.awt.GridLayout;
import java.sql.*;
import javax.swing.*;

public class EditPro extends JFrame {
    private JTextField idField, usernameField, passwordField, nameField, dobField, phoneField, idCardField, pointField;
    private JLabel roleLabel;
    private JButton applyButton, cancelButton;
    private CustomerFrame customerFrame;
    private String userId; // Store the user ID passed from CustomerFrame

    public EditPro(CustomerFrame customerFrame, String userId) {
        this.customerFrame = customerFrame;
        this.userId = userId; // Assign user ID passed from CustomerFrame

        setTitle("Edit Profile");
        setLayout(new GridLayout(10, 2));
        setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);

        // Labels and fields for user information
        add(new JLabel("ID:"));
        idField = new JTextField();
        idField.setEditable(false);
        add(idField);

        add(new JLabel("Username:"));
        usernameField = new JTextField();
        add(usernameField);

        add(new JLabel("Password:"));
        passwordField = new JTextField();
        add(passwordField);

        add(new JLabel("Name:"));
        nameField = new JTextField();
        add(nameField);

        add(new JLabel("Role:"));
        roleLabel = new JLabel("Customer"); // Fixed as "customer"
        add(roleLabel);

        add(new JLabel("DOB (YYYY-MM-DD):"));
        dobField = new JTextField();
        add(dobField);

        add(new JLabel("Phone:"));
        phoneField = new JTextField();
        add(phoneField);

        add(new JLabel("ID Card:"));
        idCardField = new JTextField();
        add(idCardField);

        add(new JLabel("Points:"));
        pointLabel = new JLabel("");
        add(pointLabel);

        // Buttons to apply changes or cancel
        applyButton = new JButton("Apply");
        applyButton.addActionListener(e -> applyChanges());
        add(applyButton);

        cancelButton = new JButton("Cancel");
        cancelButton.addActionListener(e -> cancel());
        add(cancelButton);

        // Load user information
        loadUserInfo();

        pack();
        setLocationRelativeTo(null);
        setVisible(true);
    }

    private void loadUserInfo() {
        if (userId == null) {
            JOptionPane.showMessageDialog(this, "User ID is null. Cannot load information.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }

        try (Connection connection = DriverManager.getConnection("jdbc:mysql://localhost:3306/hbs_db", "root", "iuhuyenlemleM0@");
             PreparedStatement statement = connection.prepareStatement("SELECT * FROM users WHERE id = ?")) {
            statement.setString(1, userId);
            ResultSet resultSet = statement.executeQuery();
            if (resultSet.next()) {
                idField.setText(resultSet.getString("id"));
                usernameField.setText(resultSet.getString("username"));
                passwordField.setText(resultSet.getString("password"));
                nameField.setText(resultSet.getString("name"));
                dobField.setText(resultSet.getString("dob"));
                phoneField.setText(resultSet.getString("phone"));
                idCardField.setText(resultSet.getString("id_card"));
                pointField.setText(resultSet.getString("point"));
            } else {
                JOptionPane.showMessageDialog(this, "User not found.", "Error", JOptionPane.ERROR_MESSAGE);
            }
        } catch (SQLException e) {
            e.printStackTrace();
            JOptionPane.showMessageDialog(this, "Error loading user information.", "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    private void applyChanges() {
        // Implement apply changes logic here
    }

    private void cancel() {
        dispose();
        customerFrame.setVisible(true);
    }
}
